{
    "search": [
        {
            "name": "extract-search-params",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "search-from-beckn-request.jsonata",
                "outputKey": "graphqlVariables"
            }
        },
        {
            "name": "send-search-graphql-request",
            "type": "send-graphql-request",
            "args": {
                "graphqlFilename": "search.graphql",
                "variablesKey": "graphqlVariables",
                "outputKey": "graphqlResponse"
            }
        },
        {
            "name": "create-beckn-response",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "search-to-beckn-response.jsonata",
                "outputKey": "becknResponse.body"
            }
        }
    ],
    "select": [
        {
            "name": "extract-select-params",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "select-from-beckn-request.jsonata",
                "outputKey": "cartDetails"
            }
        },
        {
            "name": "set-orderId-graphql-header",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "set-vendure-auth-token-from-beckn.jsonata",
                "outputKey": "graphqlHeaders"
            },
            "condition": "context.cartDetails.orderId"
        },
        {
            "name": "erase-existing-cart",
            "type": "send-graphql-request",
            "args": {
                "graphqlFilename": "removeAllOrderLines.graphql",
                "headersKey": "graphqlHeaders",
                "outputKey": "removedOrderId"
            },
            "condition": "context.cartDetails.orderId"
        },
        {
            "name": "add-first-item-to-order",
            "type": "send-graphql-request",
            "args": {
                "graphqlFilename": "addItemToOrder.graphql",
                "variablesKey": "cartDetails.firstItem",
                "outputKey": "responseWithVendureAuthToken"
            }
        },
        {
            "name": "extract-vendure-auth-token",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "extractVendureAuthToken.jsonata",
                "outputKey": "vendureAuthToken"
            }
        },
        {
            "name": "set-orderId-graphql-header",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "set-vendure-auth-token-from-graphql.jsonata",
                "outputKey": "graphqlHeaders"
            }
        },
        {
            "name": "add-remaining-items-to-order",
            "type": "send-multiple-graphql-requests",
            "args": {
                "graphqlFilename": "addItemToOrder.graphql",
                "variablesKey": "cartDetails.restItems",
                "headersKey": "graphqlHeaders",
                "outputKey": "addRestItemsToOrderResponse"
            },
            "condition": "context.cartDetails.totalItems > 1"
        },
        {
            "name": "get-current-order",
            "type": "send-graphql-request",
            "args": {
                "graphqlFilename": "activeOrder.graphql",
                "headersKey": "graphqlHeaders",
                "outputKey": "order"
            }
        }
    ]
}
