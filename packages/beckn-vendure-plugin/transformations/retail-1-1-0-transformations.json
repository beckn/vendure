{
    "search": [
        {
            "name": "extract-search-params",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "search-beckn-request.jsonata",
                "outputKey": "graphqlVariables"
            }
        },
        {
            "name": "send-search-graphql-request",
            "type": "send-graphql-request",
            "args": {
                "graphqlFilename": "search.graphql",
                "variablesKey": "graphqlVariables",
                "outputKey": "graphqlResponse"
            }
        },
        {
            "name": "generate-beckn-response",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "on-search-beckn-response.jsonata",
                "outputKey": "becknResponse"
            }
        }
    ],
    "select": [
        {
            "name": "extract-transaction-id",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "extract-transaction-id-from-beckn.jsonata",
                "outputKey": "becknTransactionId",
                "common": "true"
            }
        },
        {
            "name": "get-existing-beckn-transaction",
            "type": "send-graphql-request",
            "args": {
                "graphqlFilename": "getBecknTransaction.graphql",
                "variablesKey": "becknTransactionId",
                "outputDataPath": "body.data.getBecknTransaction.vendureAuthToken",
                "outputKey": "vendureAuthToken"
            }
        },
        {
            "name": "set-existing-auth-token",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "check-if-vendure-auth-token-exists.jsonata",
                "outputKey": "usingExistingVendureAuthToken",
                "common": "true"
            }
        },
        {
            "name": "erase-existing-cart",
            "type": "send-graphql-request",
            "args": {
                "graphqlFilename": "removeAllOrderLines.graphql",
                "authTokenKey": "vendureAuthToken",
                "outputKey": "removedOrderId"
            },
            "condition": "context.usingExistingVendureAuthToken"
        },
        {
            "name": "extract-select-params",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "select-beckn-request.jsonata",
                "outputKey": "cartDetails"
            }
        },
        {
            "name": "add-first-item-to-order",
            "type": "send-graphql-request",
            "args": {
                "graphqlFilename": "addItemToOrder.graphql",
                "variablesKey": "cartDetails.firstItem",
                "authTokenKey": "vendureAuthToken",
                "outputKey": "responseWithVendureAuthToken"
            }
        },
        {
            "name": "extract-vendure-auth-token",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "extract-vendure-auth-token-from-graphql-response.jsonata",
                "outputKey": "vendureAuthToken",
                "common": "true"
            },
            "condition": "!context.usingExistingVendureAuthToken"
        },
        {
            "name": "add-remaining-items-to-order",
            "type": "send-multiple-graphql-requests",
            "args": {
                "graphqlFilename": "addItemToOrder.graphql",
                "variablesKey": "cartDetails.restItems",
                "authTokenKey": "vendureAuthToken",
                "outputKey": "addRestItemsToOrderResponse"
            },
            "condition": "context.cartDetails.totalItems > 1"
        },
        {
            "name": "form-beckn-transaction-variables",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "form-beckn-transaction-variables.jsonata",
                "common": "true",
                "outputKey": "addBecknTransactionVariables"
            },
            "condition": "!context.usingExistingVendureAuthToken"
        },
        {
            "name": "add-beckn-transaction",
            "type": "send-graphql-request",
            "args": {
                "graphqlFilename": "addBecknTransaction.graphql",
                "variablesKey": "addBecknTransactionVariables",
                "outputKey": "addBecknTransactionOutput"
            },
            "condition": "!context.usingExistingVendureAuthToken"
        },
        {
            "name": "get-current-order",
            "type": "send-graphql-request",
            "args": {
                "graphqlFilename": "activeOrderOnSelect.graphql",
                "authTokenKey": "vendureAuthToken",
                "outputKey": "currentOrderResponse"
            }
        },
        {
            "name": "get-eligible-shipping-methods",
            "type": "send-graphql-request",
            "args": {
                "graphqlFilename": "eligibleShippingMethods.graphql",
                "authTokenKey": "vendureAuthToken",
                "outputKey": "eligibleShippingMethods"
            }
        },
        {
            "name": "generate-beckn-response",
            "type": "transform-and-add",
            "args": {
                "jsonataFilename": "on-select-beckn-response.jsonata",
                "outputKey": "becknResponse"
            }
        }
    ]
}
